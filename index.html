<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Math Line</title>
	<style>
		:root {

			--bg1: #000000;
			/* pure black */
			--bg2: #050505;
			/* near black */
			--bg3: #0a0a0f;
			/* dark gray-blue */
			--bg4: #0d001a;
			/* very dark purple */

			--accent: #9d4edd;
			/* neon purple for glow */
			--text-color: #ffffff;
			--card-radius: 14px;

		}

		/* Body & animated background */
		html,
		body {
			margin: 0;
			padding: 0;
			height: 100%;
			font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
			color: var(--text-color);
			background: linear-gradient(-45deg, var(--bg1), var(--bg2), var(--bg3), var(--bg4));
			background-size: 400% 400%;
			animation: moveBackground 18s ease infinite;
			overflow-x: hidden;
			position: relative;
		}

		@keyframes moveBackground {
			0% {
				background-position: 0% 50%;
			}

			50% {
				background-position: 100% 50%;
			}

			100% {
				background-position: 0% 50%;
			}
		}

		/* Header */
		header {
			padding: 20px;
			text-align: center;
			position: relative;
			z-index: 5;
		}

		header h1 {
			margin: 0;
			font-size: 2.6rem;
			color: #00f5ff;
			text-shadow: 0 0 10px #00f5ff, 0 0 25px #00f5ff;
		}

		/* Top search & categories */
		.top-controls {
			display: flex;
			justify-content: center;
			padding: 0 12px;
			z-index: 5;
			flex-wrap: wrap;
			gap: 10px;
		}

		#search-input {
			background: rgba(20, 77, 20, 0.6);
			color: var(--text-color);
			width: 100%;
			max-width: 520px;
			padding: 8px 12px;
			font-size: 15px;
			border-radius: 8px;
			border: 2px solid rgba(255, 255, 255, 0.06);
			outline: none;
			box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
		}

		.category-dropdown {
			display: none;
		}

		.category-dropdown.mobile-active {
			display: block;
		}

		.category-bar {
			text-align: center;
			margin: 6px 0 12px;
			z-index: 5;
			display: flex;
			justify-content: center;
			flex-wrap: wrap;
			padding: 0 12px;
			gap: 8px;
		}

		.category-bar button {
			margin: 4px 6px;
			padding: 6px 12px;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			background: var(--accent);
			color: #fff;
			font-weight: 700;
			transition: transform .12s, filter .12s;
		}

		.category-bar button:hover {
			filter: brightness(1.05);
			transform: translateY(-2px);
		}

		.category-bar button.active {
			outline: 3px solid rgba(255, 255, 255, 0.06);
			background: #ff00ff;
		}

		.game-counter {
			text-align: center;
			color: var(--accent);
			margin: 8px 0;
			font-size: 14px;
			font-weight: 700;
		}

		.empty-state {
			text-align: center;
			padding: 40px 20px;
			color: var(--accent);
			font-size: 18px;
			font-weight: 700;
			grid-column: 1/-1;
			display: none;
		}

		.empty-state.show {
			display: block;
		}

		/* Game grid: smaller cards, 6 per row */
		#game-list {
			display: grid;
			grid-template-columns: repeat(6, minmax(100px, 1fr));
			gap: 10px;
			padding: 18px;
			position: relative;
			z-index: 5;
		}

		.game-card {
			width: 100%;
			aspect-ratio: 1/1;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;

			background: rgba(15, 0, 30, 0.85);
			border-radius: var(--card-radius);
			cursor: pointer;

			font-weight: 800;
			text-align: center;
			padding: 6px;
			user-select: none;

			border: 2px solid #c77dff;
			color: #c77dff;

			box-shadow:
				0 0 10px #c77dff,
				0 0 20px #9d4edd,
				0 0 40px #7b2cbf;

			transition: all 0.3s ease;
			position: relative;
		}

		.game-card:hover {
			color: #ffffff;
			border-color: #ff00ff;

			box-shadow:
				0 0 15px #ff00ff,
				0 0 30px #ff00ff,
				0 0 60px #ff00ff;

			transform: scale(1.07);
		}

		.game-card:hover {
			transform: translateY(-4px) scale(1.02);
			box-shadow: 0 12px 24px rgba(0, 0, 0, 0.55);
		}

		/* Request card steady glow */
		.game-card.request {
			box-shadow: 0 0 20px 4px var(--accent);
		}

		/* Iframe */
		#game-frame {
			display: none;
			width: 95%;
			max-width: 1200px;
			height: 680px;
			margin: 12px auto;
			border: none;
			border-radius: 12px;
			background: #000;
			position: relative;
			z-index: 6;
			box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
		}

		#game-loading {
			display: none;
			text-align: center;
			padding: 20px;
			color: var(--accent);
			z-index: 6;
			position: relative;
		}

		.spinner {
			border: 4px solid rgba(157, 78, 221, 0.3);
			border-top: 4px solid #9d4edd;
			border-radius: 50%;
			width: 40px;
			height: 40px;
			animation: spin 1s linear infinite;
			margin: 0 auto 10px;
		}

		@keyframes spin {
			0% {
				transform: rotate(0deg);
			}

			100% {
				transform: rotate(360deg);
			}
		}

		/* Floating buttons */
		.floating-btn {
			position: fixed;
			padding: 8px 12px;
			border-radius: 8px;
			border: none;
			cursor: pointer;
			z-index: 12;
			font-weight: 700;
			box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
		}

		#fullscreen-btn {
			right: 18px;
			top: 18px;
			background: var(--accent);
			color: #fff;
			display: none;
		}

		#back-btn {
			left: 18px;
			top: 18px;
			background: rgba(0, 0, 0, 0.55);
			color: #fff;
			display: none;
		}

		/* Game Details Modal */
		.modal {
			display: none;
			position: fixed;
			z-index: 15;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0, 0, 0, 0.8);
			backdrop-filter: blur(4px);
		}

		.modal.active {
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.modal-content {
			background: rgba(15, 0, 30, 0.95);
			padding: 30px;
			border-radius: 12px;
			border: 2px solid #c77dff;
			max-width: 500px;
			width: 90%;
			color: var(--text-color);
			box-shadow: 0 0 30px #9d4edd;
		}

		.modal-content h2 {
			margin-top: 0;
			color: #00f5ff;
		}

		.game-stat {
			display: flex;
			justify-content: space-between;
			padding: 8px 0;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		.game-stat label {
			color: var(--accent);
			font-weight: 700;
		}

		.game-stat value {
			color: var(--text-color);
		}

		.modal-buttons {
			display: flex;
			gap: 10px;
			margin-top: 20px;
			justify-content: center;
		}

		.modal-buttons button {
			padding: 8px 16px;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			font-weight: 700;
			transition: all 0.2s;
		}

		.play-btn {
			background: var(--accent);
			color: #fff;
		}

		.play-btn:hover {
			filter: brightness(1.1);
		}

		.close-modal {
			background: rgba(255, 255, 255, 0.1);
			color: var(--text-color);
		}

		.close-modal:hover {
			background: rgba(255, 255, 255, 0.2);
		}

		/* Decorations (falling emojis) */
		.decoration {
			position: fixed;
			pointer-events: none;
			z-index: 3;
			user-select: none;
		}

		/* Responsive */
		@media (max-width:720px) {
			header h1 {
				font-size: 2rem;
			}

			#game-list {
				grid-template-columns: repeat(3, 1fr);
				gap: 8px;
			}

			#game-frame {
				height: 480px;
			}

			.category-bar {
				gap: 4px;
				display: none;
			}

			.category-bar.mobile-visible {
				display: flex;
			}

			.category-bar button {
				margin: 2px 3px;
				padding: 4px 8px;
				font-size: 12px;
			}

			.modal-content {
				max-width: 90%;
			}
		}
	</style>
</head>

<body>
	<header>
		<h1>Math Line</h1>
	</header>
	<div style="text-align:center;font-weight:800;color:#ffd700;">

	</div>

	<div class="top-controls">
		<input id="search-input" type="search" placeholder="Search games" aria-label="Search games">
	</div>
		<div class="category-bar" id="category-filter"></div>
		<button id="category-toggle-mobile" style="display:none; background: var(--accent); color: #fff; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 700; margin: 0 12px;">üìÇ Categories</button>
		<div class="game-counter" id="game-counter"></div>
		<div id="game-list" aria-live="polite">
			<div class="empty-state" id="empty-state"></div>
		</div>

		<div id="game-loading">
			<div class="spinner"></div>
			<p>Loading game...</p>
		</div>

		<iframe id="game-frame" title="Game frame" sandbox="allow-scripts allow-same-origin"></iframe>

		<button id="fullscreen-btn" class="floating-btn" title="Enter fullscreen (F)">Fullscreen</button>
		<button id="back-btn" class="floating-btn" title="Back to games (Esc)">‚Üê Back</button>

		<!-- Game Details Modal -->
		<div id="game-modal" class="modal">
			<div class="modal-content">
				<h2 id="modal-game-name"></h2>
				<div class="game-stat">
					<label>Category:</label>
					<span id="modal-category"></span>
				</div>
				<div class="game-stat">
					<label>Times Played:</label>
					<span id="modal-played"></span>
				</div>
				<div class="game-stat">
					<label>Last Played:</label>
					<span id="modal-last-played"></span>
				</div>
				<div class="game-stat">
					<label>Total Play Time:</label>
					<span id="modal-playtime"></span>
				</div>
				<div class="modal-buttons">
					<button class="play-btn" id="modal-play-btn">‚ñ∂Ô∏è Play</button>
					<button class="close-modal" id="modal-close-btn">Close</button>
				</div>
			</div>
		</div>

		<!-- Decorations -->
		<div id="lights-container"></div>

	<script>	
			// ===================== Local Storage Manager =====================
const StorageManager = {
	getGameStats: (name) => JSON.parse(localStorage.getItem(`mathline_stats_${name}`) || '{"played":0,"lastPlayed":"Never","playTime":0,"rating":0}'),
	updateGameStats: (name) => {
		const stats = StorageManager.getGameStats(name);
		stats.played = (stats.played || 0) + 1;
		stats.lastPlayed = new Date().toLocaleDateString();
		stats.playTime = (stats.playTime || 0) + 0.01;
		localStorage.setItem(`mathline_stats_${name}`, JSON.stringify(stats));
	 let playTimer = null;
  },
	getLastCategory: () => localStorage.getItem('mathline_lastCategory') || 'All',
	setLastCategory: (cat) => localStorage.setItem('mathline_lastCategory', cat),
	getLastSearch: () => localStorage.getItem('mathline_lastSearch') || '',
	setLastSearch: (search) => localStorage.setItem('mathline_lastSearch', search),
};

		// ===================== Decorations =====================
const DECO_EMOJIS = ["‚ö°","üí•","‚ú®","üåü","üîÜ","üî•"];
const DECO_COUNT = 32;
let decorations=[];
for(let i=0;i<DECO_COUNT;i++){
  const d=document.createElement('div');
  d.className='decoration';
  d.textContent=DECO_EMOJIS[Math.floor(Math.random()*DECO_EMOJIS.length)];
  d.style.left=(Math.random()*110-5)+'vw';
  d.style.top=(Math.random()*110-5)+'vh';
  d.style.fontSize=(16+Math.random()*36)+'px';
  d.style.opacity=(0.45+Math.random()*0.55).toString();
  d.dataset.vy=(0.02+Math.random()*0.12).toString();
  d.dataset.vx=((Math.random()-0.5)*0.04).toString();
  decorations.push(d);
  document.body.appendChild(d);
}
function animateDecorations(){
  decorations.forEach(d=>{
    let top=parseFloat(d.style.top||'0')+parseFloat(d.dataset.vy)*1.1;
    let left=parseFloat(d.style.left||'0')+parseFloat(d.dataset.vx)*1.1;
    if(top>105) top=-5;
    if(top<-10) top=100;
    if(left>105) left=-5;
    if(left<-10) left=100;
    d.style.top=top+'vh';
    d.style.left=left+'vw';
    d.style.transform=`rotate(${Math.sin((top+left)*0.1)*10}deg)`;
  });
  requestAnimationFrame(animateDecorations);
}
requestAnimationFrame(animateDecorations);

// ===================== String lights =====================
const COLORS=["#ff0000","#00ff00","#ffff00","#00ffff","#ff00ff","#ffa500"];
const LIGHT_COUNT=60;
const lightsContainer=document.getElementById('lights-container');
for(let i=0;i<LIGHT_COUNT;i++){
  const bulb=document.createElement('div');
  bulb.className='light';
  const t=i/(LIGHT_COUNT-1)*Math.PI;
  bulb.style.left=(5+90*(i/(LIGHT_COUNT-1)))+'%';
  bulb.style.top=(20+10*Math.sin(t))+'%';
  bulb.style.backgroundColor=COLORS[i%COLORS.length];
  bulb.style.animationDelay=(Math.random()*2)+'s';
  lightsContainer.appendChild(bulb);
}

// ===================== Games =====================
const games=[
  {name:"Ragdoll Archers",url:"Ragdoll-Archers.html",category:"Action"},
  {name:"Ragdoll Hit",url:"Ragdoll-hit.html",category:"Action"},
  {name:"Time Shooter",url:"Time-shooter.html",category:"Action"},
  {name:"Retro Bowl",url:"Retro-bowl.html",category:"Sports"},
  {name:"Snow Rider",url:"Snow-Rider.html",category:"Racing"},
  {name:"Swords And Sandals",url:"Swords-and-sandlas.html",category:"Action"},
  {name:"Crazy Cattle",url:"Crazy-cattle.html",category:"Arcade"},
  {name:"Gladi Hoppers",url:"Gladi-hoppers.html",category:"Action"},
  {name:"Bit Planes",url:"Bit-planes.html",category:"Arcade"},
  {name:"Final Earth2",url:"Final-earth2.html",category:"Strategy"},
  {name:"Cluster Rush",url:"Cluster-rush.html",category:"Arcade"},
  {name:"Push Your Luck",url:"Push-your-luck.html",category:"Arcade"},
  {name:"Poly Track",url:"Poly-track.html",category:"Racing"},
  {name:"Ragdoll Soccer",url:"Ragdoll-soccer.html",category:"Sports"},
  {name:"Jetpack Joy Ride",url:"Jetpack-joy-ride.html",category:"Action"},
  {name:"Learn To Fly 3",url:"Learn-to-fly-3.html",category:"Racing"},
  {name:"Malidin Stun Cars",url:"Malidin-stun-cars.html",category:"Racing"},
  {name:"Gun Spin",url:"Gun-spin.html",category:"Action"},
  {name:"Age Of War",url:"Age-of-war.html",category:"Strategy"},
  {name:"Moto X3M 2",url:"Moto-x3m-2.html",category:"Racing"},
  {name:"Moto X3M Winter",url:"Moto-x3m-winter.html",category:"Racing"},
  {name:"Basketball Stars",url:"Basketball-stars.html",category:"Sports"},
  {name:"Idle Breakout",url:"Idle-breakout.html",category:"Arcade"},
  {name:"Vex 8",url:"Vex-8.html",category:"Action"},
  {name:"Tiny Fishing",url:"Tiny-fishing.html",category:"Simulation"},
  {name:"Drive Mad",url:"Drive-mad.html",category:"Racing"},
  {name:"Stick Man Hook",url:"Stick-man-hook.html",category:"Action"},
  {name:"Line Rider",url:"Line-rider.html",category:"Racing"},
  {name:"Unicycle Hero",url:"Unicycle-hero.html",category:"Action"},
  {name:"Basket Random",url:"Basket-random.html",category:"Sports"},
  {name:"1v1 Lol",url:"1v1-lol.html",category:"Action"},
  {name:"Happy Wheels",url:"Happy-wheels.html",category:"Action"},
  {name:"Idle Miner Tycoon",url:"Idle-miner-tycoon.html",category:"Simulation"},
  {name:"Johnny Upgrade",url:"Johnny-upgrade.html",category:"Arcade"},
  {name:"Jack Smith",url:"Jack-smith.html",category:"Action"},
  {name:"Tunnel Rush",url:"Tunnel-rush.html",category:"Racing"},
  {name:"Duck Life 5",url:"Duck-life-5.html",category:"Simulation"},
  {name:"Duck Life 4",url:"Duck-life-4.html",category:"Simulation"},
  {name:"Mob Control",url:"Mob-control.html",category:"Action"},
  {name:"A Small World Cup",url:"A-small-world-cup.html",category:"Sports"},
  {name:"Escape Road",url:"Escape-road.html",category:"Racing"},
  {name:"QWOP",url:"QWOP.html",category:"Simulation"},
  {name:"Indian Truck Simulator",url:"Indian-truck-simulator.html",category:"Simulation"},
  {name:"Doge Miner",url:"Doge-miner.html",category:"Simulation"},
  {name:"Draw Climber",url:"Draw-climber.html",category:"Racing"},
  {name:"Slope 3",url:"Slope-3.html",category:"Racing"},
  {name:"Infinte Craft",url:"Infinte-craft.html",category:"Simulation"},
  {name:"Block Blast",url:"Block-blast.html",category:"Arcade"},
  {name:"Melon playground",url:"Melon-playground.html",category:"Simulation"},
  {name:"House of hazards",url:"house-of-hazards.html",category:"Action"},
  {name:"Binding of Issac",url:"Binding-of-issac.html",category:"Action"},
  {name:"Troll Face Quest 10",url:"Troll-face-10.html",category:"Puzzle"},
  {name:"Troll Face Quest 11",url:"Troll-face-11.html",category:"Puzzle"},
  {name:"Troll Face Quest 12",url:"Troll-face-12.html",category:"Puzzle"},
  {name:"Ultimate Car Driving Simulator 3",url:"ultimate-car-simulator.html",category:"Racing"},
  {name:"Wordle",url:"Wordle.html",category:"Puzzle"},
  {name:"Cappybara Clicker",url:"Cappybara-clicker.html",category:"Simulation"},
  {name:"Bob The Robber 5",url:"bob-robber.html",category:"Action"},
  {name:"Car Crash 3D",url:"Car-crash-3d.html",category:"Racing"},
  {name:"Bit Life",url:"Bit-life.html",category:"Simulation"},
  {name:"Plants vs Zombies",url:"Plants-vs-zombies.html",category:"Action"},
  {name:"Tall Man Run",url:"tall-man-run.html",category:"Racing"},
  {name:"Tag",url:"tag.html",category:"Racing"},
  {name:"Subway Surfers Winter",url:"Subway-Winter.html",category:"Racing"},
  {name:"Subway Surfers Miami",url:"Subway-miami.html",category:"Racing"},
  {name:"Hole.io",url:"Hole-io.html",category:"Simulation"},
  {name:"Drift Boss",url:"Drift-boss.html",category:"Racing"},
  {name:"Subway Surfers Mexico",url:"Subway-mexico.html",category:"Racing"},
  {name:"Subway Surfers London",url:"Subway-london.html",category:"Racing"},
  {name:"Subway Surfers Iceland",url:"Subway-iceland.html",category:"Racing"},
  {name:"Granny 2",url:"Granny2.html",category:"Puzzle"},
  {name:"Granny 3",url:"Granny3.html",category:"Puzzle"},
  {name:"Factory Balls 2",url:"Factory-balls2.html",category:"Simulation"},
  {name:"Factory Balls 3",url:"Factory-balls3.html",category:"Simulation"},
  {name:"Geometry Dash Lite",url:"Geometry-Dash.html",category:"Racing"},
  {name:"Hardware Tycoon",url:"Hardware-tycoon.html",category:"Arcade"},
  {name:"CSGO Cliker",url:"CsGo-clicker.html",category:"Arcade"},
  {name:"Cross Road",url:"Crossy-road.html",category:"Arcade"},
  {name:"Burrito Bison",url:"BB.html",category:"Arcade"},
  {name:"Burrito Bison Launch a Libre",url:"BL.html",category:"Arcade"},
  {name:"Burrito Bison Revenge",url:"BR.html",category:"Arcade"},
  {name:"Space Waves",url:"Space-waves.html",category:"Arcade"},
  {name:"The legend of Zelda Ocarina",url:"Zelda0.html",category:"Arcade"},
  {name:"Pokemon emerald randomized",url:"PER.html",category:"Arcade"},
  {name:"Roof Top Snipers",url:"RF.html",category:"Arcade"},
  {name:"Ultimate car driving simulator",url:"Ucarsim.html",category:"Racing"},
  {name:"Traffic Jam 3D",url:"Tj.html",category:"Arcade"},
  {name:"Papa's freezeria",url:"Pf.html",category:"Arcade"},
  {name:"Papa's pastaria",url:"Pp.html",category:"Arcade"},
  {name:"Papa's sushiria",url:"Ps.html",category:"Arcade"},
  {name:"Ballz",url:"Ballz.html",category:"Arcade"},
  {name:"10 Minutes Till Dawn",url:"10min.html",category:"Arcade"},
  {name:"Minecraft",url:"EaglerCraft 1.12 [wasm].html",category:"Arcade"},
  {name:"Request a Game",url:"#",category:"Request",request:true},
  {name:"PaperClip Sim",url:"UniversalPaperclips-2.1.1.zip",category:"Arcade"},

];

// Separate games by letter type and sort
const normalGames = games.filter(g => !g.request).sort((a, b) => {
  const aStartsWithNum = /^\d/.test(a.name);
  const bStartsWithNum = /^\d/.test(b.name);
  
  if(aStartsWithNum && !bStartsWithNum) return 1;
  if(!aStartsWithNum && bStartsWithNum) return -1;
  return a.name.localeCompare(b.name);
});
const requestCard = games.find(g => g.request);

// ===================== DOM Elements =====================
const gameListEl = document.getElementById('game-list');
const emptyStateEl = document.getElementById('empty-state');
const iframe = document.getElementById('game-frame');
const backBtn = document.getElementById('back-btn');
const fullscreenBtn = document.getElementById('fullscreen-btn');
const categoryEl = document.getElementById('category-filter');
const searchInput = document.getElementById('search-input');
const gameModal = document.getElementById('game-modal');
const gameCounter = document.getElementById('game-counter');
const gameLoading = document.getElementById('game-loading');
const categoryToggleMobile = document.getElementById('category-toggle-mobile');

// ===================== Setup Categories =====================
const categories = ["All", ...new Set(normalGames.map(g => g.category))].sort((a, b) => {
  if(a === "All") return -1;
  if(b === "All") return 1;
  return a.localeCompare(b);
});

let activeCategory = StorageManager.getLastCategory();
let activeSearch = '';

categories.forEach(cat => {
  const btn = document.createElement('button');
  btn.textContent = cat;
  if(cat === activeCategory) btn.classList.add('active');
  btn.addEventListener('click', () => {
    document.querySelectorAll('.category-bar button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    activeCategory = cat;
    StorageManager.setLastCategory(cat);
    renderGames();
    window.scrollTo(0, 0);
  });
  categoryEl.appendChild(btn);
});

// Mobile category toggle
categoryToggleMobile.addEventListener('click', () => {
	categoryEl.classList.toggle('mobile-visible');
});

// ===================== Modal Manager =====================
const ModalManager = {
	open: (gameName) => {
		const game = normalGames.find(g => g.name === gameName);
		if(!game) return;
		
		const stats = StorageManager.getGameStats(gameName);
		const lastPlayed = stats.lastPlayed || "Never";
		const roundedTime = parseFloat((stats.playTime || 0).toFixed(2));
		
		const playTimeStr = roundedTime > 60
		? `${Math.floor(roundedTime / 60)}h ${(roundedTime % 60).toFixed(2)}m`
		: `${roundedTime}m`;
		
		document.getElementById('modal-game-name').textContent = gameName;
		document.getElementById('modal-category').textContent = game.category;
		document.getElementById('modal-played').textContent = stats.played || '0';
		document.getElementById('modal-last-played').textContent = lastPlayed;
		document.getElementById('modal-playtime').textContent = playTimeStr;
		
		document.getElementById('modal-play-btn').onclick = () => ModalManager.play(gameName);
		gameModal.classList.add('active');
	},
	close: () => {
		gameModal.classList.remove('active');
	},
	play: (gameName) => {
		const game = normalGames.find(g => g.name === gameName);
		if(!game) return;
		
		StorageManager.updateGameStats(gameName);
		
 playTimer = setInterval(() => {
	StorageManager.updateGameStats(gameName);
	}, 1000);
		
    gameListEl.style.display = 'none';
		gameLoading.style.display = 'block';
		iframe.style.display = 'none';
		backBtn.style.display = 'block';
		fullscreenBtn.style.display = 'block';
		gameModal.classList.remove('active');
		
		// Simulate loading delay
		setTimeout(() => {
			iframe.src = game.url;
			iframe.style.display = 'block';
			gameLoading.style.display = 'none';
		}, 500);
	}
};

document.getElementById('modal-close-btn').addEventListener('click', ModalManager.close);
gameModal.addEventListener('click', (e) => {
	if(e.target === gameModal) ModalManager.close();
});

// ===================== Render =====================
function renderGames(){
gameListEl.innerHTML="";

// Filter games
let filtered = normalGames;

if(activeCategory !== "All"){
filtered = filtered.filter(g => g.category === activeCategory);
}

if(activeSearch){
filtered = filtered.filter(g => g.name.toLowerCase().includes(activeSearch.toLowerCase()));
}

// Render all filtered games
filtered.forEach(g => {
const card = createGameCard(g);
gameListEl.appendChild(card);
});

// Always append request card at the bottom (ALWAYS appears)
const reqCard = document.createElement('div');
reqCard.className = 'game-card request';
reqCard.innerHTML = '<span>Request a Game</span>';
reqCard.addEventListener('click', () => {
window.open('https://docs.google.com/forms/d/e/1FAIpQLScGV9D3vWWpSj7nmcbH8segX7uh0K8Cbli50mb9LM5QeoQD_Q/viewform?usp=dialog',
'_blank');
});
gameListEl.appendChild(reqCard);

// Update counter (keep it visible always)
const totalGames = filtered.length;
gameCounter.textContent = `Showing ${totalGames} game${totalGames !== 1 ? 's' : ''} ${activeCategory !== 'All' ? `‚Ä¢
${activeCategory}` : ''}${activeSearch ? ` ‚Ä¢ Searched for "${activeSearch}"` : ''}`;

// Show/hide category toggle on mobile
if(window.innerWidth <= 720) { categoryToggleMobile.style.display=filtered.length===0 && !activeSearch ? 'none'
	: 'block' ; } } function createGameCard(game) { const card=document.createElement('div'); card.className='game-card'
	; card.innerHTML=`<span>${game.name}</span>`;

card.addEventListener('click', () => {
ModalManager.open(game.name);
});

return card;
}
function createGameCard(game) {
const card = document.createElement('div');
card.className = 'game-card';
card.innerHTML = `<span>${game.name}</span>`;

card.addEventListener('click', () => {
ModalManager.open(game.name);
});

return card;
}

renderGames(); // ADD THIS LINE - renders games on page load

// ===================== Search =====================
searchInput.addEventListener('input', (e) => {
activeSearch = e.target.value;
StorageManager.setLastSearch(activeSearch);
renderGames();
});

searchInput.addEventListener('input', (e) => {
  activeSearch = e.target.value;
  StorageManager.setLastSearch(activeSearch);
  renderGames();
});

// ===================== Keyboard Shortcuts =====================
document.addEventListener('keydown', (e) => {
	// "/" to focus search
	if(e.key === '/' && !searchInput.matches(':focus')) {
		e.preventDefault();
		searchInput.focus();
	}
	
	// "Esc" to close game
	if(e.key === 'Escape' && iframe.style.display === 'block') {
		backBtn.click();
	}
	
	// "F" for fullscreen
	if(e.key === 'f' || e.key === 'F') {
		if(iframe.style.display === 'block') {
			e.preventDefault();
			fullscreenBtn.click();
		}
	}
	
	// "C" to toggle categories on mobile
	if((e.key === 'c' || e.key === 'C') && window.innerWidth <= 720) {
		categoryToggleMobile.click();
	}
});

// ===================== Back & Fullscreen =====================
  backBtn.addEventListener('click', () => {
if (playTimer) {
clearInterval(playTimer);
playTimer = null;
}
  iframe.style.display = 'none';
  gameLoading.style.display = 'none';
  iframe.src = '';
  gameListEl.style.display = 'grid';
  backBtn.style.display = 'none';
  fullscreenBtn.style.display = 'none';
  window.scrollTo(0, 0);
});

fullscreenBtn.addEventListener('click', () => {
  if(iframe.requestFullscreen) iframe.requestFullscreen();
  else if(iframe.webkitRequestFullscreen) iframe.webkitRequestFullscreen();
});

// Handle iframe errors
iframe.addEventListener('error', () => {
	gameLoading.innerHTML = '<p style="color: #ff6b6b; font-size: 16px;">‚ö†Ô∏è Failed to load game. Try again?</p>';
	setTimeout(() => {
		gameLoading.style.display = 'none';
	}, 3000);
});

// Mobile responsiveness
window.addEventListener('resize', () => {
	if(window.innerWidth > 720) {
		categoryToggleMobile.style.display = 'none';
		categoryEl.classList.remove('mobile-visible');
	}
});
		</script>
</body>

</html>
