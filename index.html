<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Math Line</title>
<style>
:root {
  --bg1:#1a0000; --bg2:#4a0d0d; --bg3:#7d1a1a; --bg4:#2a0000;
  --accent:#ffb300; --header-color:#fff; --text-color:#f0f0f0;
  --card-bg:rgba(0,0,0,0.5); --card-radius:12px; --card-shadow:1;
  --card-font:'Poppins', sans-serif; --bg-speed:12s;
  --hover-scale:1.02; --hover-glow:1;
}

body {
  font-family: var(--card-font);
  text-align: center;
  color: var(--text-color);
  margin: 0;
  padding: 0;
  overflow-x: hidden;
  background: linear-gradient(-45deg,var(--bg1),var(--bg2),var(--bg3),var(--bg4));
  background-size: 400% 400%;
  animation: moveBackground var(--bg-speed) ease infinite;
  transition: all 0.3s;
}

@keyframes moveBackground {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

canvas#bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  background: transparent;
}

header {
  padding: 25px;
}

header h1 {
  margin: 0;
  font-size: 2.8em;
  color: var(--header-color);
  text-shadow: 0 0 15px var(--accent);
}

#player-count {
  font-size: 14px;
  font-weight: normal;
  margin-top: 5px;
  color: var(--accent);
}

#search-container {
  position: fixed;
  top: 25px;
  left: 25px;
  z-index: 1001;
}

#search-input {
  padding: 10px;
  border-radius: 8px;
  border: 2px solid var(--accent);
  background: #1a0a0a;
  color: var(--accent);
}

#settings-btn {
  position: fixed;
  top: 25px;
  right: 25px;
  font-size: 28px;
  background: none;
  border: none;
  cursor: pointer;
  color: var(--accent);
  z-index: 1001;
}

#back-btn, #fullscreen-btn {
  position: fixed;
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background: var(--accent);
  cursor: pointer;
  z-index: 1001;
  display: none;
}

#back-btn { top: 100px; left: 25px; }
#fullscreen-btn { top: 100px; right: 25px; }

#settings-menu {
  position: fixed;
  top: 0;
  right: -320px;
  width: 300px;
  height: 100%;
  background: rgba(0,0,0,0.9);
  color: #fff;
  display: flex;
  flex-direction: column;
  padding: 30px 20px;
  gap: 10px;
  transition: right 0.3s ease;
  z-index: 1000;
  overflow-y: auto;
}

#settings-menu.open { right: 0; }

#settings-menu h2 { margin-top: 0; text-align: center; }

#settings-menu label {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

#settings-menu input[type=color],
#settings-menu select,
#settings-menu input[type=range] {
  cursor: pointer;
}

#settings-menu button {
  padding: 8px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  background: var(--accent);
  color: #000;
  font-weight: bold;
  transition: .2s;
}

#settings-menu button:hover { filter: brightness(1.2); }

.game-list {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  padding: 80px 20px 20px;
}

.game-card {
  position: relative;
  background: var(--card-bg);
  border: 2px solid var(--accent);
  color: var(--accent);
  width: 230px;
  padding: 30px;
  border-radius: var(--card-radius);
  cursor: pointer;
  transition: transform .25s, box-shadow .25s;
  font-size: 1.2em;
  font-family: var(--card-font);
  box-shadow: var(--card-shadow)?0 0 10px rgba(0,0,0,0.5):none;
}

.game-card:hover {
  transform: scale(var(--hover-scale));
  box-shadow: var(--hover-glow)?0 0 15px var(--accent):none;
}

iframe#game-frame {
  display: none;
  width: 95%;
  height: 650px;
  margin: 0 auto;
  border: none;
  border-radius: 14px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.6);
  background: #000;
}
</style>
</head>
<body>

<canvas id="bg"></canvas>

<header>
  <h1>Math Line</h1>
  <div id="player-count">Players Online: <span id="count">0</span></div>
</header>

<div id="search-container">
  <input type="text" id="search-input" placeholder="Search games...">
</div>

<button id="settings-btn">⚙️</button>
<button id="back-btn">⬅ Back</button>
<button id="fullscreen-btn">⛶ Fullscreen</button>

<div id="settings-menu">
  <h2>Settings</h2>
  <label>Background 1:<input type="color" id="bg1" value="#1a0000"></label>
  <label>Background 2:<input type="color" id="bg2" value="#4a0d0d"></label>
  <label>Background 3:<input type="color" id="bg3" value="#7d1a1a"></label>
  <label>Background 4:<input type="color" id="bg4" value="#2a0000"></label>
  <label>Accent Color:<input type="color" id="accent" value="#ffb300"></label>
  <label>Header Color:<input type="color" id="header-color" value="#ffffff"></label>
  <label>Text Color:<input type="color" id="text-color" value="#f0f0f0"></label>
  <label>Card Radius:<input type="range" id="card-radius" min="0" max="50" value="12"></label>
  <label>Card Shadow:<input type="checkbox" id="card-shadow" checked></label>
  <label>Particle Count:<input type="range" id="particle-count" min="10" max="150" value="70"></label>
  <label>Particle Size:<input type="range" id="particle-size" min="1" max="5" value="2"></label>
  <label>Particle Speed:<input type="range" id="particle-speed" min="0.1" max="1.5" step="0.05" value="0.5"></label>
  <label>Hover Scale:<input type="range" id="hover-scale" min="1" max="1.5" step="0.01" value="1.02"></label>
  <label>Hover Glow:<input type="checkbox" id="hover-glow" checked></label>
  <label>Font Family:<select id="card-font">
    <option value="Poppins">Poppins</option>
    <option value="Arial">Arial</option>
    <option value="Comic Sans MS">Comic Sans</option>
    <option value="Courier New">Courier New</option>
  </select></label>
  <label>Background Speed:<input type="range" id="bg-speed" min="2" max="30" value="12"></label>
  <label><input type="checkbox" id="toggle-particles" checked> Show Particles</label>
  <label><input type="checkbox" id="toggle-mode"> Dark Mode</label>
  <button id="random-theme">Random Theme</button>
  <button id="reset-theme">Reset Theme</button>
  <button id="close-settings">Close</button>
</div>

<div class="game-list" id="game-list"></div>

<iframe id="game-frame"></iframe>

<footer>
  <p>Made with ❤️ for players</p>
</footer>

<script>
// --- PARTICLES ---
const canvas=document.getElementById('bg');
const ctx=canvas.getContext('2d');
canvas.width=innerWidth;
canvas.height=innerHeight;
let particles=[],particleCount=70,particleSize=2,particleSpeed=0.5,particlesOn=true;

function createParticles(reset=false){
  if(reset) particles=[];
  while(particles.length<particleCount){
    particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*particleSize+1,dx:(Math.random()-0.5)*particleSpeed,dy:(Math.random()-0.5)*particleSpeed,color:document.getElementById('accent').value});
  }
}
createParticles();

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(particlesOn) particles.forEach(p=>{
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=p.color; ctx.fill();
    p.x+=p.dx; p.y+=p.dy;
    if(p.x<0||p.x>canvas.width)p.dx*=-1;
    if(p.y<0||p.y>canvas.height)p.dy*=-1;
  });
  requestAnimationFrame(animate);
}
animate();

window.addEventListener('resize',()=>{canvas.width=innerWidth;canvas.height=innerHeight;});

// --- GAMES ---
const games=[
  {name:"Ragdoll Archers", file:"ragdoll-archers.html"},
  {name:"Ragdoll Hit", file:"ragdoll-hit.html"},
  {name:"Time Shooter", file:"time-shooter.html"},
  {name:"Retro Bowl", file:"retro-bowl.html"},
  {name:"Snow Rider", file:"snow-rider.html"},
  {name:"Swords and Sandals", file:"swords-and-sandals.html"},
  {name:"Crazy Cattle", file:"crazy-cattle.html"},
  {name:"Gladi Hoppers", file:"gladi-hoppers.html"},
  {name:"Bit Planes", file:"bit-planes.html"},
  {name:"Final Earth2", file:"final-earth2.html"},
  {name:"Cluster Rush", file:"cluster-rush.html"},
  {name:"Push Your Luck", file:"push-your-luck.html"},
  {name:"Poly Track", file:"poly-track.html"},
  {name:"Ragdoll Soccer", file:"ragdoll-soccer.html"},
  {name:"Jetpack Joy Ride", file:"jetpack-joy-ride.html"},
  {name:"Learn to Fly 3", file:"learn-to-fly-3.html"},
  {name:"Malidin Stun Cars", file:"malidin-stun-cars.html"},
  {name:"Gun Spin", file:"gun-spin.html"},
  {name:"Age of War", file:"age-of-war.html"},
  {name:"Moto X3M 2", file:"moto-x3m-2.html"},
  {name:"Moto X3M Winter", file:"moto-x3m-winter.html"},
  {name:"Basketball Stars", file:"basketball-stars.html"},
  {name:"Idle Breakout", file:"idle-breakout.html"},
  {name:"Vex 8", file:"vex-8.html"},
  {name:"Tiny Fishing", file:"tiny-fishing.html"},
  {name:"Drive Mad", file:"drive-mad.html"},
  {name:"Stick Man Hook", file:"stick-man-hook.html"},
  {name:"Learn to Fly 2", file:"learn-to-fly-2.html"},
  {name:"Line Rider", file:"line-rider.html"},
  {name:"Unicycle Hero", file:"unicycle-hero.html"},
  {name:"Basket Random", file:"basket-random.html"},
  {name:"1v1 LOL", file:"1v1-lol.html"},
  {name:"Happy Wheels", file:"happy-wheels.html"},
  {name:"Idle Dice", file:"idle-dice.html"},
  {name:"Idle Miner Tycoon", file:"idle-miner-tycoon.html"},
  {name:"Johnny Upgrade", file:"johnny-upgrade.html"},
  {name:"Jack Smith", file:"jack-smith.html"},
  {name:"Tunnel Rush", file:"tunnel-rush.html"},
  {name:"Duck Life 5", file:"duck-life-5.html"},
  {name:"Duck Life 4", file:"duck-life-4.html"},
  {name:"Mob Control", file:"mob-control.html"},
  {name:"A Small World Cup", file:"a-small-world-cup.html"},
  {name:"Escape Road", file:"escape-road.html"},
  {name:"QWOP", file:"qwop.html"},
  {name:"Indian Truck Simulator", file:"indian-truck-simulator.html"},
  {name:"Mr Mine Clone", file:"mr-mine-clone.html"},
  {name:"Doge Miner", file:"doge-miner.html"},
  {name:"Draw Climber", file:"draw-climber.html"},
  {name:"Granny Online", file:"granny-online.html"}
];

const gameList=document.getElementById("game-list");
let favorites = JSON.parse(localStorage.getItem("favorites")) || [];

function toggleFavorite(name) {
  if (favorites.includes(name)) favorites = favorites.filter(f => f!==name);
  else favorites.push(name);
  localStorage.setItem("favorites", JSON.stringify(favorites));
  renderGames();
}

function renderGames() {
  gameList.innerHTML = "";
  const searchVal = document.getElementById('search-input').value.toLowerCase();
  const sortedGames = games.sort((a,b)=>a.name.localeCompare(b.name));
  sortedGames.forEach(g=>{
    if(!g.name.toLowerCase().includes(searchVal)) return;
    const card = document.createElement("div");
    card.className="game-card";
    card.onclick=()=> {
      document.getElementById('game-frame').src=g.file;
      document.getElementById('game-frame').style.display='block';
      gameList.style.display='none';
      document.getElementById('back-btn').style.display='block';
      document.getElementById('fullscreen-btn').style.display='block';
      window.scrollTo(0,0);
    };
    // Favorite star
    const star = document.createElement("div");
    star.textContent = favorites.includes(g.name)?"⭐":"☆";
    star.style.position="absolute";
    star.style.top="10px"; star.style.right="10px";
    star.style.cursor="pointer"; star.style.fontSize="18px";
    star.onclick=(e)=>{e.stopPropagation(); toggleFavorite(g.name);};
    card.appendChild(star);

    const span = document.createElement("span");
    span.textContent=g.name;
    card.appendChild(span);

    gameList.appendChild(card);
  });
}
document.getElementById('search-input').addEventListener('input',renderGames);
renderGames();

// --- BACK & FULLSCREEN ---
document.getElementById('back-btn').onclick=function(){
  document.getElementById('game-frame').style.display='none';
  document.getElementById('game-frame').src='';
  gameList.style.display='flex';
  document.getElementById('back-btn').style.display='none';
  document.getElementById('fullscreen-btn').style.display='none';
};
document.getElementById('fullscreen-btn').onclick=function(){
  const frame=document.getElementById('game-frame');
  if(frame.requestFullscreen) frame.requestFullscreen();
  else if(frame.webkitRequestFullscreen) frame.webkitRequestFullscreen();
  else if(frame.msRequestFullscreen) frame.msRequestFullscreen();
};

// --- SETTINGS ---
const settingsBtn=document.getElementById('settings-btn');
const settingsMenu=document.getElementById('settings-menu');
document.getElementById('close-settings').onclick=()=>settingsMenu.classList.remove('open');
settingsBtn.onclick=()=>settingsMenu.classList.toggle('open');

const setInputs=['bg1','bg2','bg3','bg4','accent','header-color','text-color','card-radius','card-shadow','particle-count','particle-size','particle-speed','hover-scale','hover-glow','card-font','bg-speed','toggle-particles'];
setInputs.forEach(id=>{
  const el=document.getElementById(id);
  if(!el) return;
  el.addEventListener('input',updateSettings);
  el.addEventListener('change',updateSettings);
});

function updateSettings(){
  document.documentElement.style.setProperty('--bg1',document.getElementById('bg1').value);
  document.documentElement.style.setProperty('--bg2',document.getElementById('bg2').value);
  document.documentElement.style.setProperty('--bg3',document.getElementById('bg3').value);
  document.documentElement.style.setProperty('--bg4',document.getElementById('bg4').value);
  document.documentElement.style.setProperty('--accent',document.getElementById('accent').value);
  document.documentElement.style.setProperty('--header-color',document.getElementById('header-color').value);
  document.documentElement.style.setProperty('--text-color',document.getElementById('text-color').value);
  document.documentElement.style.setProperty('--card-radius',document.getElementById('card-radius').value+'px');
  document.documentElement.style.setProperty('--card-font',document.getElementById('card-font').value);
  document.documentElement.style.setProperty('--hover-scale',document.getElementById('hover-scale').value);
  particleCount=parseInt(document.getElementById('particle-count').value);
  particleSize=parseFloat(document.getElementById('particle-size').value);
  particleSpeed=parseFloat(document.getElementById('particle-speed').value);
  particlesOn=document.getElementById('toggle-particles').checked;
  createParticles(true);
}

// Random / Reset Theme
document.getElementById('random-theme').onclick=function(){
  ['bg1','bg2','bg3','bg4','accent','header-color','text-color'].forEach(id=>{
    document.getElementById(id).value='#'+Math.floor(Math.random()*16777215).toString(16);
  }); updateSettings();
};
document.getElementById('reset-theme').onclick=function(){
  document.getElementById('bg1').value="#1a0000";
  document.getElementById('bg2').value="#4a0d0d";
  document.getElementById('bg3').value="#7d1a1a";
  document.getElementById('bg4').value="#2a0000";
  document.getElementById('accent').value="#ffb300";
  document.getElementById('header-color').value="#ffffff";
  document.getElementById('text-color').value="#f0f0f0";
  updateSettings();
};

// --- PLAYER COUNT ---
const countEl=document.getElementById('count');
async function updatePlayerCount(){
  try{
    const res=await fetch('https://api.countapi.xyz/hit/mathline/site');
    const data=await res.json();
    countEl.innerText=data.value;
  }catch(e){console.log(e);}
}
setInterval(updatePlayerCount,5000);
updatePlayerCount();
</script>

</body>
</html>
